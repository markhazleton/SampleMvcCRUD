using System;

namespace UISampleSpark.Data.Tests.Models
{
    [TestClass]
    public class DepartmentTests
    {
        [TestMethod]
        public void TestMethod1()
        {
            // Arrange
            Department department = new Department()
            {
                Name = "Department",
                CreatedBy = "Test",
                Description = "Test",
                Id = 1,
                LastUpdatedBy = "Test",
            };

            // Act


            // Assert
            Assert.IsNotNull(department);
            Assert.AreEqual(department.CreatedDate.Date, DateTime.Now.Date);
        }
    }
}


using UISampleSpark.Data.Repository;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;

namespace UISampleSpark.Data.Tests.Models;
[TestClass]
public class EmployeeContextTests
{
    [TestMethod]
    public async Task EmployeeContext_ExpectedBehaviorAsync()
    {
        // Arrange
        DbContextOptions<EmployeeContext> options = new DbContextOptionsBuilder<EmployeeContext>()
            .UseInMemoryDatabase("EmployeeTest")
            .Options;
        using EmployeeContext context = new EmployeeContext(options);
        // Act
        await context.Database.EnsureDeletedAsync();
        await context.Database.EnsureCreatedAsync();

        EmployeeMock employeeMock = new EmployeeMock();
        List<EmployeeResponse> employeeList = new List<EmployeeResponse>();
        List<DepartmentResponse> departmentList = new List<DepartmentResponse>();
        EmployeeDatabaseService svc = new EmployeeDatabaseService(context);

        foreach (DepartmentDto dept in employeeMock.DepartmentCollection())
        {
            departmentList.Add(await svc.SaveDepartmentAsync(dept));
        }
        int deptSuccess = departmentList.Where(w => w.Success).Count();

        foreach (EmployeeDto emp in employeeMock.EmployeeCollection())
        {
            employeeList.Add(await svc.SaveEmployeeDbAsync(emp));
        }
        int emptSuccess = employeeList.Where(w => w.Success).Count();

        // Assert
        Assert.IsNotNull(context);
        Assert.AreEqual(emptSuccess, await context.Employees.CountAsync());
        Assert.AreEqual(deptSuccess, await context.Departments.CountAsync());

    }
}


namespace UISampleSpark.Data.Tests.Models;

[TestClass]
public class EmployeeTests
{
    [TestMethod]
    public void Employee_Test()
    {
        // Arrange
        Employee employee = new Employee
        {
            Age = 20,
            Country = "USA",
            DepartmentId = 1,
            Id = 1,
            Name = "Test Employee",
            State = "TX",
            Department = new Department()
            {
                Id = 1,
                Name = "Test",
                Description = "Test"
            }
        };
        // Act
        employee.Age = 21;

        // Assert
        Assert.IsNotNull(employee);
    }
}

using UISampleSpark.Data.Repository;
using System;
using System.Linq;
using System.Threading.Tasks;

namespace UISampleSpark.Data.Tests.Repository;

[TestClass]
public class EmployeeDBTests : IDisposable
{
    private EmployeeDB? employeeDB;
    private EmployeeContext? context;
    private readonly string databaseName;

    public EmployeeDBTests()
    {
        databaseName = $"EmployeeDBTests_{Guid.NewGuid()}";
    }

    [TestInitialize]
    public async Task Initialize()
    {
        try
        {
            DbContextOptionsBuilder<EmployeeContext> builder = new DbContextOptionsBuilder<EmployeeContext>();
            _ = builder.EnableSensitiveDataLogging(true);
            _ = builder.UseInMemoryDatabase(databaseName);
            context = new EmployeeContext(builder.Options);
            employeeDB = new EmployeeDB(context);

            EmployeeMock employeeMock = new EmployeeMock();
            foreach (DepartmentDto dept in employeeMock.DepartmentCollection())
            {
                await employeeDB.UpdateAsync(dept).ConfigureAwait(true);
            }
            foreach (EmployeeDto emp in employeeMock.EmployeeCollection())
            {
                await employeeDB.UpdateAsync(emp).ConfigureAwait(true);
            }
        }
        catch (Exception ex)
        {
            Console.Write(ex.Message);
            throw;
        }
    }

    [TestCleanup]
    public void Cleanup()
    {
        context?.Dispose();
    }

    public void Dispose()
    {
        context?.Dispose();
        GC.SuppressFinalize(this);
    }
    [TestMethod]
    public async Task Department_List_Expected()
    {
        // Arrange

        // Act
        System.Collections.Generic.List<DepartmentDto> result = await employeeDB.DepartmentCollectionAsync();

        // Assert
        Assert.IsNotNull(result);
    }
    [TestMethod]
    public async Task Department_iD1_Expected()
    {
        // Arrange
        int DeptId = 1;
        // Act
        DepartmentDto result = await employeeDB.DepartmentAsync(DeptId);

        // Assert
        Assert.IsNotNull(result);
    }
    [TestMethod]
    public async Task Department_iD1_Update()
    {
        // Arrange
        int DeptId = 1;
        // Act
        DepartmentDto result = await employeeDB.DepartmentAsync(DeptId);

        result.Description = "Test Description";
        result.Name = "Test Name";
        DepartmentDto? result2 = await employeeDB.UpdateAsync(result);
        // Assert
        Assert.IsNotNull(result);
        Assert.IsNotNull(result2);
        Assert.AreEqual(result2.Name, "HR");
        Assert.AreEqual(result2.Description, "HR");
    }
    [TestMethod]
    public async Task Department_Update_Null()
    {
        // Arrange
        DepartmentDto? test = null;
        // Act
        DepartmentDto? result = await employeeDB.UpdateAsync(test);
        // Assert
        Assert.IsNull(result);
    }

    [TestMethod]
    public async Task Department_Update_Id1()
    {
        // Arrange
        DepartmentDto test = new()
        {
            Id = 1,
            Name = "HR",
            Description = "HR"
        };

        // Act
        DepartmentDto? result = await employeeDB.UpdateAsync(test);
        // Assert
        Assert.IsNotNull(result);
        Assert.AreEqual(result.Id, 1);
        Assert.AreEqual(result.Name, test.Name);
    }
    [TestMethod]
    public async Task Department_Update_MaxPlusOne()
    {
        // Arrange
        System.Collections.Generic.List<DepartmentDto> depts = await employeeDB.DepartmentCollectionAsync();
        DepartmentDto dept = depts.OrderByDescending(d => d.Id).First();

        DepartmentDto? test = new((EmployeeDepartmentEnum)dept.Id);

        // Act
        DepartmentDto? result = await employeeDB.UpdateAsync(test);
        // Assert
        Assert.IsNotNull(result);
        Assert.AreEqual(result.Id, test.Id);
        Assert.AreEqual(result.Name, test.Name);
        Assert.AreEqual(result.Description, test.Description);
    }

    [TestMethod]
    public async Task Delete_StateUnderTest_ExpectedBehaviorNewEmployee()
    {
        // Arrange
        EmployeeDto newEmp = new EmployeeDto(
            99,
            "Test User",
            33,
            "Texas",
            "USA",
            EmployeeDepartmentEnum.IT);

        // Act

        // Get Current count of employees
        System.Collections.Generic.List<EmployeeDto> initResult = await employeeDB.EmployeeCollectionAsync();

        // Add New Employee with Update
        EmployeeDto? addResult = await employeeDB.UpdateAsync(newEmp);
        // Get updated count of employees
        System.Collections.Generic.List<EmployeeDto> updatedResult = await employeeDB.EmployeeCollectionAsync();
        /// Delete the Employee
        bool result = await employeeDB.DeleteEmployeeAsync(addResult.Id);
        // Get result after delete
        System.Collections.Generic.List<EmployeeDto> finalResult = await employeeDB.EmployeeCollectionAsync();

        // Assert
        Assert.IsNotNull(result);
        Assert.AreEqual(finalResult.Count, initResult.Count);

    }


    [TestMethod]
    public async Task Delete_StateUnderTest_ExpectedBehaviorNotFound()
    {
        // Arrange
        int ID = 0;

        // Act
        bool result = await employeeDB.DeleteEmployeeAsync(ID);

        // Assert
        Assert.IsFalse(result);
    }

    [TestMethod]
    public async Task Employee_StateUnderTest_ExpectedBehavior()
    {
        // Arrange
        int id = 0;

        // Act
        EmployeeDto? result = await employeeDB.EmployeeAsync(id);

        // Assert
        Assert.IsNull(result);
    }

    [TestMethod]
    public async Task EmployeeCollection_StateUnderTest_ExpectedBehavior()
    {
        // Arrange

        // Act
        System.Collections.Generic.List<EmployeeDto> result = await employeeDB.EmployeeCollectionAsync();

        // Assert
        Assert.IsNotNull(result);
    }

    [TestMethod]
    public async Task Update_StateUnderTest_ExpectedBehaviorNewEmployee()
    {
        // Arrange
        EmployeeDto newEmp = new EmployeeDto(
            99,
            "Test User",
            33,
            "Texas",
            "USA",
            EmployeeDepartmentEnum.IT);

        // Act

        // Get Current count of employees
        System.Collections.Generic.List<EmployeeDto> initResult = await employeeDB.EmployeeCollectionAsync();

        // Add New Employee with Update
        EmployeeDto? addResult = await employeeDB.UpdateAsync(newEmp);

        // Get updated count of employees
        System.Collections.Generic.List<EmployeeDto> updatedResult = await employeeDB.EmployeeCollectionAsync();
        /// Update the Employee
        addResult.Name = "Test User 2";
        addResult.Age = 44;
        addResult.State = "FL";
        addResult.Department = EmployeeDepartmentEnum.Accounting;
        EmployeeDto? result = await employeeDB.UpdateAsync(addResult);
        // Get result after update
        EmployeeDto? finalResult = await employeeDB.EmployeeAsync(result.Id);

        // Assert
        Assert.IsNotNull(result);
        Assert.AreEqual(addResult.Id, result.Id);
        Assert.AreEqual(finalResult.Age, 44);
        Assert.AreEqual(finalResult.State, "FL");

    }
    /// <summary>
    /// 
    /// </summary>
    [TestMethod]
    public async Task Update_NewEmployee()
    {
        // Arrange
        EmployeeDto emp = new EmployeeDto(
            99,
            "Test User",
            33,
            "Texas",
            "USA",
            EmployeeDepartmentEnum.IT);

        // Act
        EmployeeDto? result = await employeeDB.UpdateAsync(emp);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsTrue(result.Id > 0);
    }
    /// <summary>
    /// 
    /// </summary>
    [TestMethod]
    public async Task Update_NewEmployeeWithId98()
    {
        // Arrange
        EmployeeDto emp = new EmployeeDto(
            98,
            "Test User",
            33,
            "Texas",
            "USA",
            EmployeeDepartmentEnum.IT);


        // Act
        EmployeeDto? result = await employeeDB.UpdateAsync(emp);

        // Assert
        Assert.IsNotNull(result);
        Assert.AreEqual(98, result.Id);
    }

    [TestMethod]
    public async Task Update_NullEmployee()
    {
        // Arrange
        EmployeeDto? emp = null;

        // Act
        EmployeeDto? result = await employeeDB!.UpdateAsync(emp);

        // Assert
        Assert.IsNull(result);
    }

    [TestMethod]
    public async Task DepartmentAsync_WithInvalidId_ShouldThrowException()
    {
        // Arrange
        int invalidId = 9999;

        // Act & Assert
        try
        {
            await employeeDB!.DepartmentAsync(invalidId);
            Assert.Fail("Expected ArgumentException was not thrown");
        }
        catch (ArgumentException)
        {
            // Expected exception
            Assert.IsTrue(true);
        }
    }

    [TestMethod]
    public async Task DepartmentCollectionAsync_ShouldReturnOrderedList()
    {
        // Arrange & Act
        System.Collections.Generic.List<DepartmentDto> result = await employeeDB!.DepartmentCollectionAsync();

        // Assert
        Assert.IsNotNull(result);
        Assert.IsTrue(result.Count > 0);
        for (int i = 1; i < result.Count; i++)
        {
            Assert.IsTrue(string.Compare(result[i - 1].Name, result[i].Name, StringComparison.Ordinal) <= 0);
        }
    }

    [TestMethod]
    public async Task EmployeeCollectionAsync_ShouldReturnOrderedList()
    {
        // Arrange & Act
        System.Collections.Generic.List<EmployeeDto> result = await employeeDB!.EmployeeCollectionAsync();

        // Assert
        Assert.IsNotNull(result);
        Assert.IsTrue(result.Count > 0);
        for (int i = 1; i < result.Count; i++)
        {
            Assert.IsTrue(string.Compare(result[i - 1].Name, result[i].Name, StringComparison.Ordinal) <= 0);
        }
    }

    [TestMethod]
    public async Task DeleteEmployeeAsync_WithInvalidId_ShouldReturnFalse()
    {
        // Arrange
        int invalidId = -1;

        // Act
        bool result = await employeeDB!.DeleteEmployeeAsync(invalidId);

        // Assert
        Assert.IsFalse(result);
    }

    [TestMethod]
    public async Task UpdateAsync_Employee_WithExistingId_ShouldUpdate()
    {
        // Arrange
        System.Collections.Generic.List<EmployeeDto> employees = await employeeDB!.EmployeeCollectionAsync();
        EmployeeDto existingEmployee = employees.First();
        int originalId = existingEmployee.Id;
        string newName = "Updated Name " + Guid.NewGuid();

        existingEmployee.Name = newName;

        // Act
        EmployeeDto? result = await employeeDB.UpdateAsync(existingEmployee);

        // Assert
        Assert.IsNotNull(result);
        Assert.AreEqual(originalId, result.Id);
        Assert.AreEqual(newName, result.Name);
    }

    [TestMethod]
    public async Task UpdateAsync_Department_WithNewDepartment_ShouldCreate()
    {
        // Arrange
        DepartmentDto newDept = new DepartmentDto(EmployeeDepartmentEnum.Accounting);

        // Act
        DepartmentDto? result = await employeeDB!.UpdateAsync(newDept);

        // Assert
        Assert.IsNotNull(result);
        Assert.AreEqual((int)EmployeeDepartmentEnum.Accounting, result.Id);
        Assert.AreEqual(EmployeeDepartmentEnum.Accounting.ToString(), result.Name);
    }

    [TestMethod]
    public async Task UpdateAsync_Department_WithZeroId_ShouldReturnNull()
    {
        // Arrange
        DepartmentDto dept = new DepartmentDto
        {
            Id = 0,
            Name = "Invalid",
            Description = "Invalid"
        };

        // Act
        DepartmentDto? result = await employeeDB!.UpdateAsync(dept);

        // Assert
        Assert.IsNull(result);
    }

    [TestMethod]
    public async Task UpdateAsync_Employee_CompleteDataUpdate()
    {
        // Arrange
        EmployeeDto newEmp = new EmployeeDto(
            0,
            "Complete Test User",
            28,
            "California",
            "USA",
            EmployeeDepartmentEnum.Marketing);
        newEmp.ProfilePicture = "test.jpg";
        newEmp.Gender = GenderEnum.Female;

        // Act
        EmployeeDto? result = await employeeDB!.UpdateAsync(newEmp);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsTrue(result.Id > 0);
        Assert.AreEqual("Complete Test User", result.Name);
        Assert.AreEqual(28, result.Age);
        Assert.AreEqual("California", result.State);
        Assert.AreEqual(EmployeeDepartmentEnum.Marketing, result.Department);
        Assert.AreEqual(GenderEnum.Female, result.Gender);
    }

    [TestMethod]
    public async Task EmployeeAsync_WithInvalidId_ShouldReturnNull()
    {
        // Arrange
        int invalidId = -999;

        // Act
        EmployeeDto? result = await employeeDB!.EmployeeAsync(invalidId);

        // Assert
        Assert.IsNull(result);
    }

    [TestMethod]
    public async Task UpdateAsync_Department_WithValidUpdate_ShouldUpdate()
    {
        // Arrange
        System.Collections.Generic.List<DepartmentDto> depts = await employeeDB!.DepartmentCollectionAsync();
        DepartmentDto existingDept = depts.First();
        string newDescription = "Updated Description " + Guid.NewGuid();

        DepartmentDto updateDept = new DepartmentDto(EmployeeDepartmentEnum.IT)
        {
            Id = existingDept.Id,
            Description = newDescription
        };

        // Act
        DepartmentDto? result = await employeeDB.UpdateAsync(updateDept);

        // Assert
        Assert.IsNotNull(result);
        Assert.AreEqual(existingDept.Id, result.Id);
    }
}

using UISampleSpark.Data.Repository;
using System;
using System.Threading.Tasks;

namespace UISampleSpark.Data.Tests.Repository
{
    [TestClass]
    public class EmployeeMockTests
    {
        [TestMethod]
        public async Task DepartmentAsync_StateUnderTest_ExpectedBehavior()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();
            int id = 1;

            // Act
            DepartmentDto? result = await employeeMock.DepartmentAsync(id);

            // Assert
            Assert.IsNotNull(result);
        }

        [TestMethod]
        public async Task EmployeeAsync_StateUnderTest_ExpectedBehavior()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();
            int id = 0;

            // Act
            EmployeeDto? result = await employeeMock.EmployeeAsync(id);

            // Assert
            Assert.IsNull(result);
        }
        [TestMethod]
        public async Task Delete_StateUnderTest_Id1()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();
            int ID = 1;

            // Act
            bool result = await employeeMock.DeleteEmployeeAsync(ID);

            // Assert
            Assert.IsNotNull(result);
        }

        [TestMethod]
        public async Task Delete_StateUnderTest_ExpectedBehavior()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();
            int ID = 0;

            // Act
            bool result = await employeeMock.DeleteEmployeeAsync(ID);

            // Assert
            Assert.IsNotNull(result);
        }

        [TestMethod]
        public async Task DeleteAsync_StateUnderTest_ExpectedBehavior()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();
            int ID = 0;

            // Act
            bool result = await employeeMock.DeleteEmployeeAsync(
                ID);

            // Assert
            Assert.IsNotNull(result);
        }

        [TestMethod]
        public void DepartmentCollection_StateUnderTest_ExpectedBehavior()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();

            // Act
            System.Collections.Generic.List<DepartmentDto> result = employeeMock.DepartmentCollection();

            // Assert
            Assert.IsNotNull(result);
        }

        [TestMethod]
        public async Task DepartmentCollectionAsync_StateUnderTest_ExpectedBehavior()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();

            // Act
            System.Collections.Generic.List<DepartmentDto> result = await employeeMock.DepartmentCollectionAsync();

            // Assert
            Assert.IsNotNull(result);
        }

        [TestMethod]
        public void EmployeeCollection_StateUnderTest_ExpectedBehavior()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();

            // Act
            System.Collections.Generic.List<EmployeeDto> result = employeeMock.EmployeeCollection();

            // Assert
            Assert.IsNotNull(result);
        }

        [TestMethod]
        public async Task EmployeeCollectionAsync_StateUnderTest_ExpectedBehavior()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();

            // Act
            System.Collections.Generic.List<EmployeeDto> result = await employeeMock.EmployeeCollectionAsync();

            // Assert
            Assert.IsNotNull(result);
        }
        [TestMethod]
        public async Task UpdateAsync_StateUnderTest_NotFoundID()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();
            EmployeeDto emp = new(
                9999,
                "Test",
                99,
                "Test",
                "Test",
                EmployeeDepartmentEnum.IT);

            // Act
            EmployeeDto? result = await employeeMock.UpdateAsync(emp);

            // Assert
            Assert.IsNotNull(result);
            Assert.AreEqual(result.Id, 9999);
            Assert.IsTrue(result.IsValid());
        }
        [TestMethod]
        public async Task UpdateAsync_StateUnderTest_NotValid()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();
            EmployeeDto? emp = null;

            // Act
            EmployeeDto? result = await employeeMock.UpdateAsync(emp);

            // Assert
            Assert.IsNull(result);
        }

        [TestMethod]
        public async Task UpdateAsync_StateUnderTest_ExpectedBehavior()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();
            EmployeeDto? emp = null;

            // Act
            EmployeeDto? result = await employeeMock.UpdateAsync(emp);

            // Assert
            Assert.IsNull(result);
        }

        [TestMethod]
        public async Task UpdateAsync_StateUnderTest_ExpectedBehavior1()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();
            DepartmentDto? dept = null;

            // Act
            DepartmentDto? result = await employeeMock.UpdateAsync(dept);

            // Assert
            Assert.IsNull(result);
        }


        [TestMethod]
        public async Task Delete_StateUnderTest_ExpectedBehaviorNotFound()
        {
            // Arrange
            EmployeeMock employeeMock = new EmployeeMock();
            int ID = 0;

            // Act
            bool result = await employeeMock.DeleteEmployeeAsync(ID);

            // Assert
            Assert.IsNotNull(result);
        }

        [TestMethod]
        public async Task Employee_StateUnderTest_ExpectedBehavior()
        {
            // Arrange
            EmployeeMock employeeDB = new EmployeeMock();
            int id = 0;

            // Act
            EmployeeDto? result = await employeeDB.EmployeeAsync(id);

            // Assert
            Assert.IsNull(result);
        }

        [TestMethod]
        public async Task EmployeeCollection_ExpectedBehavior()
        {
            // Arrange
            EmployeeMock employeeDB = new EmployeeMock();

            // Act
            System.Collections.Generic.List<EmployeeDto> result = await employeeDB.EmployeeCollectionAsync();

            // Assert
            Assert.IsNotNull(result);
        }

        [TestMethod]
        public async Task Update_StateUnderTest_ExpectedBehaviorNewEmployee()
        {
            // Arrange
            EmployeeMock employeeDB = new EmployeeMock();
            EmployeeDto newEmp = new(
                9999,
                "Test",
                99,
                "Test",
                "Test",
                EmployeeDepartmentEnum.IT);


            // Act

            // Get Current count of employees
            System.Collections.Generic.List<EmployeeDto> initResult = await employeeDB.EmployeeCollectionAsync();

            // Add New Employee with Update
            EmployeeDto? addResult = await employeeDB.UpdateAsync(newEmp);

            // Get updated count of employees
            System.Collections.Generic.List<EmployeeDto> updatedResult = await employeeDB.EmployeeCollectionAsync();
            /// Update the Employee
            addResult.Name = "Test User 2";
            addResult.Age = 44;
            addResult.State = "FL";
            addResult.Department = EmployeeDepartmentEnum.Accounting;
            EmployeeDto? result = await employeeDB.UpdateAsync(addResult);
            // Get result after update
            EmployeeDto? finalResult = await employeeDB.EmployeeAsync(result.Id);

            // Assert
            Assert.IsNotNull(result);
            Assert.AreEqual(addResult.Id, result.Id);
            Assert.AreEqual(finalResult?.Age, 44);
            Assert.AreEqual(finalResult?.State, "FL");

        }

        [TestMethod]
        public void EmployeeMock_Constructor_WithGeneratedEmployees()
        {
            // Arrange & Act
            EmployeeMock mock = new EmployeeMock(NullLogger<EmployeeMock>.Instance, 20);

            // Assert
            System.Collections.Generic.List<EmployeeDto> employees = mock.EmployeeCollection();
            Assert.IsNotNull(employees);
            Assert.IsTrue(employees.Count >= 20);
        }

        [TestMethod]
        public async Task EmployeeMock_UpdateAsync_NewEmployee_ShouldAdd()
        {
            // Arrange
            EmployeeMock mock = new EmployeeMock();
            int initialCount = mock.EmployeeCollection().Count;

            EmployeeDto newEmp = new EmployeeDto(
                0,
                "New Mock Employee",
                40,
                "Arizona",
                "USA",
                EmployeeDepartmentEnum.IT);

            // Act
            EmployeeDto? result = await mock.UpdateAsync(newEmp);

            // Assert
            Assert.IsNotNull(result);
            Assert.IsTrue(result.Id > 0);
            Assert.AreEqual(initialCount + 1, mock.EmployeeCollection().Count);
        }

        [TestMethod]
        public async Task EmployeeMock_UpdateAsync_NullDepartment_ShouldReturnNull()
        {
            // Arrange
            EmployeeMock mock = new EmployeeMock();
            DepartmentDto? nullDept = null;

            // Act
            DepartmentDto? result = await mock.UpdateAsync(nullDept);

            // Assert
            Assert.IsNull(result);
        }

        [TestMethod]
        public async Task EmployeeMock_DepartmentAsync_InvalidId_ShouldThrowOrReturnNull()
        {
            // Arrange
            EmployeeMock mock = new EmployeeMock();
            int invalidId = 9999;

            // Act  & Assert - EmployeeMock throws exception for invalid department IDs
            try
            {
                DepartmentDto? result = await mock.DepartmentAsync(invalidId);
                // Some implementations may return null
                Assert.IsNull(result);
            }
            catch (ArgumentException)
            {
                // Expected behavior for invalid ID
                Assert.IsTrue(true);
            }
        }
    }
}

using UISampleSpark.Core.Interfaces;

namespace UISampleSpark.Data.Tests.Services;

using Microsoft.VisualStudio.TestTools.UnitTesting;
using Moq;
using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;

[TestClass]
public class EmployeeDatabaseClientTests
{
    [TestMethod]
    public async Task AddMultipleEmployeesAsync_ShouldCallServiceMethod()
    {
        // Arrange
        string[] namelist = { "John", "Jane" };
        Mock<IEmployeeService> serviceMock = new Mock<IEmployeeService>();
        serviceMock.Setup(s => s.AddMultipleEmployeesAsync(namelist)).ReturnsAsync(2);
        EmployeeDatabaseClient client = new EmployeeDatabaseClient(serviceMock.Object);

        // Act
        int result = await client.AddMultipleEmployeesAsync(namelist);

        // Assert
        Assert.AreEqual(2, result);
        serviceMock.Verify(s => s.AddMultipleEmployeesAsync(namelist), Times.Once);
    }

    [TestMethod]
    public async Task DeleteAsync_ShouldCallServiceMethod()
    {
        // Arrange
        int id = 1;
        CancellationToken cancellationToken = new CancellationToken();
        EmployeeResponse response = new EmployeeResponse();
        Mock<IEmployeeService> serviceMock = new Mock<IEmployeeService>();
        serviceMock.Setup(s => s.DeleteAsync(id, cancellationToken)).ReturnsAsync(response);
        EmployeeDatabaseClient client = new EmployeeDatabaseClient(serviceMock.Object);

        // Act
        EmployeeResponse result = await client.DeleteAsync(id, cancellationToken);

        // Assert
        Assert.AreEqual(response, result);
        serviceMock.Verify(s => s.DeleteAsync(id, cancellationToken), Times.Once);
    }

    [TestMethod]
    public async Task FindDepartmentByIdAsync_ShouldCallServiceMethod()
    {
        // Arrange
        int departmentId = (int)EmployeeDepartmentEnum.IT;
        CancellationToken cancellationToken = new CancellationToken();
        DepartmentDto departmentDto = new DepartmentDto(EmployeeDepartmentEnum.IT);
        Mock<IEmployeeService> serviceMock = new Mock<IEmployeeService>();
        serviceMock.Setup(s => s.FindDepartmentByIdAsync(departmentId, cancellationToken)).ReturnsAsync(departmentDto);
        EmployeeDatabaseClient client = new EmployeeDatabaseClient(serviceMock.Object);

        // Act
        DepartmentDto result = await client.FindDepartmentByIdAsync(departmentId, cancellationToken);

        // Assert
        Assert.AreEqual(departmentDto, result);
        serviceMock.Verify(s => s.FindDepartmentByIdAsync(departmentId, cancellationToken), Times.Once);
    }

    [TestMethod]
    public async Task FindEmployeeByIdAsync_ShouldCallServiceMethod()
    {
        // Arrange
        int employeeId = 1;
        CancellationToken cancellationToken = new CancellationToken();
        EmployeeDto employee = new EmployeeDto(employeeId, "Test", 20, "Texas", "USA", EmployeeDepartmentEnum.IT);
        EmployeeResponse employeeResponse = new EmployeeResponse(employee);
        Mock<IEmployeeService> serviceMock = new Mock<IEmployeeService>();
        serviceMock.Setup(s => s.FindEmployeeByIdAsync(employeeId, cancellationToken)).ReturnsAsync(employeeResponse);
        EmployeeDatabaseClient client = new EmployeeDatabaseClient(serviceMock.Object);

        // Act
        EmployeeResponse result = await client.FindEmployeeByIdAsync(employeeId, cancellationToken);

        // Assert
        Assert.AreEqual(employeeResponse, result);
        serviceMock.Verify(s => s.FindEmployeeByIdAsync(employeeId, cancellationToken), Times.Once);
    }
    [TestMethod]
    public async Task GetDepartmentsAsync_ShouldCallServiceMethod()
    {
        // Arrange
        bool includeEmployees = true;
        CancellationToken cancellationToken = new CancellationToken();
        List<DepartmentDto> departmentDtos = new List<DepartmentDto>
        {
            new DepartmentDto(EmployeeDepartmentEnum.IT),
            new DepartmentDto(EmployeeDepartmentEnum.HR)
        };
        Mock<IEmployeeService> serviceMock = new Mock<IEmployeeService>();
        serviceMock.Setup(s => s.GetDepartmentsAsync(includeEmployees, cancellationToken)).ReturnsAsync(departmentDtos);
        EmployeeDatabaseClient client = new EmployeeDatabaseClient(serviceMock.Object);

        // Act
        IEnumerable<DepartmentDto> result = await client.GetDepartmentsAsync(includeEmployees, cancellationToken);

        // Assert
        Assert.AreEqual(departmentDtos, result);
        serviceMock.Verify(s => s.GetDepartmentsAsync(includeEmployees, cancellationToken), Times.Once);
    }

}

using UISampleSpark.Core.Interfaces;
using UISampleSpark.Data.Repository;
using System;
using System.Linq;
using System.Threading;
using System.Threading.Tasks;

namespace UISampleSpark.Data.Tests.Services;

/// <summary>
/// 
/// </summary>
[TestClass]
public class EmployeeDatabaseServiceTests : IDisposable
{
    private readonly CancellationToken ct;
    private IEmployeeService? employeeService;
    private EmployeeContext? context;
    private readonly string databaseName;

    public EmployeeDatabaseServiceTests()
    {
        databaseName = $"EmployeeDatabaseServiceTests_{Guid.NewGuid()}";
        ct = default;
    }


    /// <summary>
    /// 
    /// </summary>
    [TestMethod]
    public async Task AddMultiple_StateUnderTest_Null()
    {
        // Arrange
        string?[]? namelist = null;

        // Act
        int result = await employeeService!.AddMultipleEmployeesAsync(namelist);

        // Assert
        Assert.AreEqual(-1, result);
    }

    [TestMethod]
    public async Task AddMultiple_StateUnderTest_Valid()
    {
        // Arrange
        string[] namelist = new string[] { "TestMultiple1", "TestMultiple2", "TestMultiple3" };

        // Act
        PagingParameterModel paging = new PagingParameterModel();
        int initResults = (await employeeService!.GetEmployeesAsync(paging, ct).ConfigureAwait(true)).Count();
        int result = await employeeService.AddMultipleEmployeesAsync(namelist).ConfigureAwait(true);
        int afterResults = (await employeeService.GetEmployeesAsync(paging, ct).ConfigureAwait(true)).Count();
        System.Collections.Generic.IEnumerable<EmployeeDto> empList = await employeeService.GetEmployeesAsync(paging, ct).ConfigureAwait(true);
        EmployeeDto? emp1 = empList.Where(w => w.Name == namelist[0]).FirstOrDefault();

        // Assert
        Assert.IsNotNull(emp1);
        Assert.AreEqual(emp1.Name, namelist[0]);
    }
    [TestMethod]
    public async Task DeleteAsync_ExpectedBehavior()
    {
        // Arrange
        EmployeeDto employee = new EmployeeDto(
            99,
            "TestDelete",
            20,
            "TX",
            "USA",
            EmployeeDepartmentEnum.IT
        );
        employee.Gender = GenderEnum.Male;

        // Act
        EmployeeResponse? result = await employeeService!.SaveAsync(employee, ct);
        int id = result?.Resource?.Id ?? 0;
        EmployeeResponse afterResults = await employeeService.DeleteAsync(id, ct);


        // Assert
        Assert.IsNotNull(result);
        Assert.IsNotNull(afterResults);
        Assert.IsTrue(afterResults.Success);

    }

    [TestMethod]
    public async Task DeleteAsync_StateUnderTest_ExpectedBehavior()
    {
        // Arrange
        int id = 0;

        // Act
        EmployeeResponse result = await employeeService!.DeleteAsync(
            id,
            ct);

        // Assert
        Assert.AreEqual(result.Success, false);
    }

    [TestMethod]
    public async Task FindByIdAsync_StateUnderTest_ExpectedBehavior()
    {
        // Arrange
        int id = 0;

        // Act
        EmployeeResponse result = await employeeService!.FindEmployeeByIdAsync(id, ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsFalse(result.Success);
    }

    [TestMethod]
    public async Task Get_StateUnderTest_ExpectedBehavior()
    {
        // Arrange

        // Act
        System.Collections.Generic.IEnumerable<EmployeeDto> result = await employeeService!.GetEmployeesAsync(new PagingParameterModel(), ct);

        // Assert
        Assert.IsNotNull(result);
    }

    [TestMethod]
    public async Task GetAsync_StateUnderTest_ExpectedBehavior()
    {
        // Arrange

        // Act
        System.Collections.Generic.IEnumerable<EmployeeDto> result = await employeeService!.GetEmployeesAsync(new PagingParameterModel(), ct);

        // Assert
        Assert.IsNotNull(result);
    }

    [TestInitialize]
    public async Task Initialize()
    {
        try
        {
            DbContextOptionsBuilder<EmployeeContext> builder = new DbContextOptionsBuilder<EmployeeContext>();
            _ = builder.EnableSensitiveDataLogging(true);
            _ = builder.UseInMemoryDatabase(databaseName);
            context = new EmployeeContext(builder.Options);
            employeeService = new EmployeeDatabaseService(context);

            EmployeeMock employeeMock = new EmployeeMock();
            foreach (DepartmentDto dept in employeeMock.DepartmentCollection())
            {
                await employeeService.SaveAsync(dept, ct).ConfigureAwait(true);
            }
            foreach (EmployeeDto emp in employeeMock.EmployeeCollection())
            {
                await employeeService.UpdateAsync(emp.Id, emp, ct).ConfigureAwait(true);
            }
        }
        catch (Exception ex)
        {
            Console.Write(ex.Message);
            throw;
        }
    }

    [TestCleanup]
    public void Cleanup()
    {
        context?.Dispose();
    }

    public void Dispose()
    {
        context?.Dispose();
        GC.SuppressFinalize(this);
    }

    [TestMethod]
    public async Task Save_StateUnderTest_ValidNew()
    {
        // Arrange
        EmployeeDto item = new(
            999,
            "Test",
            25,
            "Texas",
            "USA",
            EmployeeDepartmentEnum.IT);

        // Act
        EmployeeResponse result = await employeeService.SaveAsync(item, ct);

        result.Resource.Age = 50;

        EmployeeResponse UpdateResult = await employeeService.SaveAsync(result.Resource, ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsTrue(result.Success);
        Assert.IsNotNull(result);
        Assert.IsNotNull(UpdateResult);
        Assert.IsTrue(UpdateResult.Success);
        Assert.AreEqual(50, UpdateResult.Resource?.Age);
    }

    [TestMethod]
    public async Task SaveAsync_StateUnderTest_Null()
    {
        // Arrange
        EmployeeDto? item = null;

        // Act
        EmployeeResponse result = await employeeService.SaveAsync(item, ct);

        // Assert
        Assert.IsNotNull(result);
    }
    /// <summary>
    /// 
    /// </summary>
    /// <returns></returns>
    [TestMethod]
    public async Task SaveAsync_StateUnderTest_Valid()
    {
        // Arrange
        CancellationToken cancellationToken = default;
        EmployeeDto item = new(
            999,
            "Test",
            25,
            "Texas",
            "USA",
            EmployeeDepartmentEnum.IT);

        // Act
        EmployeeResponse result = await employeeService.SaveAsync(item, cancellationToken);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsTrue(result.Success);
    }
    [TestMethod]
    public async Task SaveAsync_StateUnderTest_ValidNew()
    {
        // Arrange
        EmployeeDto item = new(
            999,
            "Test",
            25,
            "Texas",
            "USA",
            EmployeeDepartmentEnum.IT);

        // Act
        EmployeeResponse result = await employeeService.SaveAsync(item, ct);
        if (result.Success)
            item = result.Resource;

        EmployeeResponse FindResult = await employeeService.FindEmployeeByIdAsync(item.Id, ct).ConfigureAwait(true);

        if (FindResult.Success)
            item = FindResult.Resource;

        item.Age = 50;

        EmployeeResponse UpdateResult = await employeeService.SaveAsync(item, ct);

        if (UpdateResult.Success)
            item = UpdateResult.Resource;


        // Assert
        Assert.IsNotNull(result);
        Assert.IsTrue(result.Success);
        Assert.IsNotNull(item);
        Assert.IsNotNull(UpdateResult);
        Assert.IsTrue(UpdateResult.Success);
        Assert.AreEqual(50, UpdateResult.Resource?.Age);
    }
    /// <summary>
    /// 
    /// </summary>
    /// <returns></returns>
    [TestMethod]
    public async Task UpdateAsync_EmployeeId0()
    {
        // Arrange
        int id = 0;
        EmployeeDto item = new(
            999,
            "Test",
            25,
            "Texas",
            "USA",
            EmployeeDepartmentEnum.IT);

        // Act
        EmployeeResponse result = await employeeService.UpdateAsync(id, item, ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsFalse(result.Success);
        Assert.AreEqual("Mismatch in id(0) && id(999).", result.Message);
    }
    /// <summary>
    /// 
    /// </summary>
    /// <returns></returns>
    [TestMethod]
    public async Task UpdateAsync_LookupEmployeeId99_NoMatch()
    {
        // Arrange
        int id = 999;
        // Act
        EmployeeDto item = new(
            1,
            "Test",
            25,
            "Texas",
            "USA",
            EmployeeDepartmentEnum.IT);

        EmployeeResponse result = await employeeService.UpdateAsync(
            id,
            item,
            ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsFalse(result.Success);
        Assert.AreEqual("Mismatch in id(999) && id(1).", result.Message);
    }
    /// <summary>
    /// 
    /// </summary>
    /// <returns></returns>
    [TestMethod]
    public async Task UpdateAsync_LookupEmployeeId999_NotFound()
    {
        // Arrange
        int id = 999;
        // Act
        EmployeeDto item = new(
            999,
            "Test",
            25,
            "Texas",
            "USA",
            EmployeeDepartmentEnum.IT);


        EmployeeResponse result = await employeeService.UpdateAsync(
            id,
            item,
            ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsTrue(result.Success);
        Assert.AreEqual(string.Empty, result.Message);
    }
    /// <summary>
    /// 
    /// </summary>
    /// <returns></returns>
    [TestMethod]
    public async Task UpdateAsync_NullEmployeeId99()
    {
        // Arrange
        int id = 99;
        EmployeeDto? employee = null;

        // Act
        EmployeeResponse result = await employeeService.UpdateAsync(
            id,
            employee,
            ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsFalse(result.Success);
        Assert.AreEqual("Can not update null employee", result.Message);
    }
    [TestMethod]
    public async Task UpdateAsync_NullEmployeeIdZero()
    {
        // Arrange
        int id = 0;
        EmployeeDto? employee = null;

        // Act
        EmployeeResponse result = await employeeService!.UpdateAsync(
            id,
            employee,
            ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsFalse(result.Success);
    }

    [TestMethod]
    public async Task GetDepartmentsAsync_WithoutEmployees_ShouldReturnDepartments()
    {
        // Arrange
        bool includeEmployees = false;

        // Act
        System.Collections.Generic.IEnumerable<DepartmentDto> result = await employeeService!.GetDepartmentsAsync(includeEmployees, ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsTrue(result.Any());
    }

    [TestMethod]
    public async Task GetDepartmentsAsync_WithEmployees_ShouldReturnDepartmentsWithEmployees()
    {
        // Arrange
        bool includeEmployees = true;

        // Act
        System.Collections.Generic.IEnumerable<DepartmentDto> result = await employeeService!.GetDepartmentsAsync(includeEmployees, ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsTrue(result.Any());
    }

    [TestMethod]
    public async Task FindDepartmentByIdAsync_WithValidId_ShouldReturnDepartment()
    {
        // Arrange
        int deptId = (int)EmployeeDepartmentEnum.IT;

        // Act
        DepartmentDto? result = await employeeService!.FindDepartmentByIdAsync(deptId, ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.AreEqual(deptId, result.Id);
    }

    [TestMethod]
    public async Task FindDepartmentByIdAsync_WithInvalidId_ShouldReturnNull()
    {
        // Arrange
        int deptId = 9999;

        // Act
        DepartmentDto? result = await employeeService!.FindDepartmentByIdAsync(deptId, ct);

        // Assert
        Assert.IsNull(result);
    }

    [TestMethod]
    public async Task SaveDepartmentAsync_WithNullDepartment_ShouldReturnError()
    {
        // Arrange
        DepartmentDto? dept = null;

        // Act
        DepartmentResponse result = await employeeService!.SaveAsync(dept!, ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsFalse(result.Success);
        Assert.AreEqual("Department can not be null", result.Message);
    }

    [TestMethod]
    public async Task SaveDepartmentAsync_WithZeroId_ShouldReturnError()
    {
        // Arrange
        DepartmentDto dept = new DepartmentDto
        {
            Id = 0,
            Name = "Test",
            Description = "Test"
        };

        // Act
        DepartmentResponse result = await employeeService!.SaveAsync(dept, ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsFalse(result.Success);
        Assert.AreEqual("Zero ID not allowed", result.Message);
    }

    [TestMethod]
    public async Task SaveDepartmentAsync_WithValidDepartment_ShouldSaveDepartment()
    {
        // Arrange
        DepartmentDto dept = new DepartmentDto(EmployeeDepartmentEnum.Accounting);

        // Act
        DepartmentResponse result = await employeeService!.SaveAsync(dept, ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsTrue(result.Success);
        Assert.IsNotNull(result.Resource);
    }

    [TestMethod]
    public async Task SaveEmployeeDbAsync_WithInvalidDepartment_ShouldReturnError()
    {
        // Arrange
        EmployeeDto employee = new EmployeeDto(
            0,
            "Test User",
            25,
            "TX",
            "USA",
            (EmployeeDepartmentEnum)9999);

        // Act
        EmployeeResponse result = await employeeService!.SaveAsync(employee, ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsFalse(result.Success);
        Assert.AreEqual("Department not found", result.Message);
    }

    [TestMethod]
    public async Task GetEmployeesAsync_WithNullPaging_ShouldThrowException()
    {
        // Arrange
        PagingParameterModel? paging = null;

        // Act & Assert
        try
        {
            await employeeService!.GetEmployeesAsync(paging!, ct);
            Assert.Fail("Expected ArgumentNullException was not thrown");
        }
        catch (ArgumentNullException)
        {
            // Expected exception
            Assert.IsTrue(true);
        }
    }

    [TestMethod]
    public async Task GetEmployeesAsync_WithPaging_ShouldReturnPagedResults()
    {
        // Arrange
        PagingParameterModel paging = new PagingParameterModel
        {
            PageNumber = 1,
            PageSize = 5
        };

        // Act
        System.Collections.Generic.IEnumerable<EmployeeDto> result = await employeeService!.GetEmployeesAsync(paging, ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsTrue(result.Count() <= 5);
    }

    [TestMethod]
    public async Task SaveAsync_WithNullDepartmentDto_ShouldReturnError()
    {
        // Arrange
        DepartmentDto? dept = null;

        // Act
        DepartmentResponse result = await employeeService!.SaveAsync(dept!, ct);

        // Assert
        Assert.IsNotNull(result);
        Assert.IsFalse(result.Success);
        Assert.AreEqual("Department can not be null", result.Message);
    }
}

