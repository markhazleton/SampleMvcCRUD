# UISampleSpark Constitution (DRAFT)

> ⚠️ **DRAFT**: Generated by /speckit.discover-constitution on 2026-02-05  
> Review carefully before finalizing. Run `/speckit.constitution` to formalize.

## Discovery Context

- **Source**: Analyzed 94 C# source files in UISampleSpark repository
- **Patterns Found**: 16 high-confidence, 4 medium-confidence formalized via questions
- **Coverage**: Code quality, architecture, testing, security, CI/CD, documentation
- **Mission**: Educational reference project demonstrating ASP.NET Core CRUD patterns

---

## Core Principles

### I. Code Quality & Safety (MANDATORY)

This project maintains modern C# quality standards to serve as a reference for best practices.

- **Nullable Reference Types**: All projects MUST enable `<Nullable>enable</Nullable>` (MUST)
- **Latest C# Language**: All projects MUST use `<LangVersion>latest</LangVersion>` (MUST)
- **Code Analysis**: All projects MUST enable `<AnalysisLevel>latest-all</AnalysisLevel>` with .NET analyzers (MUST)
- **Security Rules**: Security analyzer warnings (CA5xxx, CA3xxx) MUST be set to `warning` level and not suppressed (MUST)
- **Implicit Usings**: All projects MUST enable `<ImplicitUsings>enable</ImplicitUsings>` with `GlobalUsings.cs` (MUST)

**Evidence**: 
- All 6 projects have nullable enabled: `UISampleSpark.UI.csproj`, `UISampleSpark.Core.csproj`, etc.
- `.editorconfig` configures 60+ CA rules with security rules elevated to warnings
- 100% consistency across solution

---

### II. Architecture & Design Patterns (MANDATORY)

Clean architecture with clear separation of concerns demonstrates professional patterns for learners.

- **Repository Pattern**: All data access MUST go through repository interfaces (e.g., `IEmployeeService`, `IEmployeeClient`) (MUST)
- **No Raw SQL**: Raw SQL queries (`FromSqlRaw`, `ExecuteSqlRaw`) are PROHIBITED; use EF Core LINQ (MUST)
- **DTO/Entity Separation**: DTOs (e.g., `EmployeeDto`) MUST be separate from EF entities (e.g., `Employee`) (MUST)
- **Dependency Injection**: All services MUST be registered in DI container and injected via constructors (MUST)
- **Async/Await**: All I/O operations MUST use async/await patterns (MUST)
- **ConfigureAwait(false)**: All library code (Domain, Repository layers) MUST use `.ConfigureAwait(false)` on async operations (MUST)

**Evidence**:
- Zero instances of raw SQL found in codebase
- 100% of EF operations (20+ instances) use `.ConfigureAwait(false)`
- Clear layer separation: Web → Repository → Domain → EF Context
- Examples: `EmployeeDatabaseService.cs`, `IEmployeeService.cs`

---

### III. Error Handling & API Contracts (MANDATORY)

Standardized error responses demonstrate production-ready API design.

- **Global Exception Handler**: A global exception handler MUST be implemented to catch unhandled exceptions (MUST)
- **ProblemDetails**: All API errors MUST return RFC 7807 ProblemDetails format (MUST)
- **HTTP Status Codes**: Controllers MUST return proper HTTP status codes via `ActionResult<T>` or `IActionResult` (MUST)
- **Custom Response Objects**: Service layer MAY use custom response wrappers (e.g., `EmployeeResponse`) for business logic encapsulation (MAY)

**Evidence**:
- `ProblemDetails` configured in `Program.cs`
- 20+ controller methods return `ActionResult` or `IActionResult`
- Custom response pattern: `EmployeeResponse`, `DepartmentResponse` with success/error states

**Action Required**: Add `IExceptionHandler` implementation (current gap)

---

### IV. Security Posture (EDUCATIONAL SCOPE)

This is an **educational reference project** - security features are **intentionally simplified** for learning purposes.

- **No Authentication Required**: Authentication/authorization is NOT implemented by design (EDUCATIONAL)
- **Security Documentation**: README and SECURITY.md MUST clearly state "not production-ready" and security limitations (MUST)
- **Security Scanning**: GitHub Actions MUST run CodeQL and Trivy security scans on all commits (MUST)
- **HTTPS**: Application MUST enforce HTTPS redirection in non-development environments (MUST)
- **No Secrets in Code**: Secrets MUST use User Secrets (dev) or environment variables (prod) (MUST)

**Evidence**:
- Zero `[Authorize]` attributes found (intentional)
- CodeQL workflow present: `.github/workflows/codeql-analysis.yml`
- Trivy scanning in Docker workflow
- HTTPS redirection in `Program.cs`: `app.UseHttpsRedirection()`
- User Secrets ID configured: `9c59fa67-51a0-40f7-a8f1-64f4dba7c281`

⚠️ **WARNING**: This codebase is for education/demonstration only. Do NOT deploy to production without adding:
- JWT/OAuth authentication
- Authorization policies with `[Authorize]` attributes
- Rate limiting
- Input validation middleware
- CORS policies
- API key management

---

### V. Testing Standards (ENCOURAGED)

Testing infrastructure is present to demonstrate patterns, with incremental coverage goals.

- **MSTest Framework**: All test projects MUST use MSTest framework (MUST)
- **Coverage Goal**: Aim for **25% code coverage** as baseline; increase over time (SHOULD)
- **Test Projects**: Each layer SHOULD have corresponding test project (Domain.Tests, Repository.Tests) (SHOULD)
- **Test File Naming**: Test files MUST use `*Test.cs` or `*Tests.cs` suffix (MUST)
- **Arrange-Act-Assert**: Unit tests SHOULD follow AAA pattern for clarity (SHOULD)

**Evidence**:
- MSTest configured: `UISampleSpark.Core.Tests.csproj`, `UISampleSpark.Data.Tests.csproj`
- 1 test file found: `EnumerableExtensionsTest.cs` (demonstrates pattern)
- Test projects include `coverlet.collector` for coverage reporting

**Current Status**: ~1% coverage (1 test file / 94 source files)  
**Target**: 25% baseline coverage for educational completeness

---

### VI. CI/CD & DevOps (MANDATORY)

Automated workflows ensure code quality and demonstrate modern DevOps practices.

**Required Workflows**:

1. **Test & Build Workflow** (MUST - currently missing)
   - Run on all PRs and pushes to main
   - Execute `dotnet test` with coverage reporting
   - Fail PRs if tests fail

2. **Security Scanning** (MUST - implemented)
   - CodeQL analysis for .NET security vulnerabilities
   - Trivy container scanning for Docker images
   - Upload results to GitHub Security tab
   - Run weekly on schedule

3. **Docker Build & Push** (MUST - implemented)
   - Build multi-stage Dockerfile
   - Push to Docker Hub on main branch
   - Run smoke tests on built container
   - Weekly rebuilds for security patches

**Evidence**:
- `.github/workflows/codeql-analysis.yml` (security-and-quality queries)
- `.github/workflows/docker-image.yml` (Trivy + Docker Hub push)
- Dockerfile uses Alpine base with aggressive security updates

**Action Required**: Create `.github/workflows/test-build.yml` for test gate

---

### VII. Observability & Health (RECOMMENDED)

Basic observability demonstrates production monitoring patterns.

- **Health Checks**: `/health` endpoint SHOULD be implemented and monitored (SHOULD)
- **Application Insights**: Application Insights telemetry MAY be configured for production deployments (MAY)
- **Structured Logging**: Services SHOULD use `ILogger<T>` with structured logging for educational value (SHOULD)
- **Swagger/OpenAPI**: API documentation MUST be available at `/swagger` (MUST)

**Evidence**:
- Health checks mapped: `app.MapHealthChecks("/health")` in `Program.cs`
- Application Insights configured with connection string
- Swagger enabled for all environments
- Logging configured at "Warning" level in `appsettings.json`

**Current Gap**: No `ILogger` usage in Repository or Services layers

---

### VIII. Documentation Standards (RECOMMENDED)

As an educational resource, documentation helps learners understand patterns and intent.

- **README Maintenance**: README.md MUST be kept up-to-date with features and deployment instructions (MUST)
- **CHANGELOG**: CHANGELOG.md SHOULD document milestones and breaking changes (SHOULD)
- **XML Documentation**: Public APIs, interfaces, and DTOs SHOULD have XML doc comments for Swagger (SHOULD)
- **Code Comments**: Complex business logic SHOULD have explanatory comments (SHOULD)
- **Swagger Metadata**: API endpoints SHOULD have descriptive summaries and response documentation (SHOULD)

**Evidence**:
- Comprehensive README with project history, features, deployment guides
- CHANGELOG.md maintained with milestones from 2019-2025
- Partial XML docs on `IEmployeeService` interface
- `<GenerateDocumentationFile>true</GenerateDocumentationFile>` in Web project

**Current Status**: 
- ✅ README is excellent and comprehensive
- ✅ CHANGELOG actively maintained
- ⚠️ XML documentation coverage is inconsistent (~40% estimated)

---

### IX. Dependency Management (MANDATORY)

Keep dependencies current to demonstrate modern .NET ecosystem.

- **.NET Version**: Project MUST target latest .NET version (currently .NET 10) (MUST)
- **Package Updates**: NuGet packages SHOULD be updated quarterly for security patches (SHOULD)
- **Dependabot**: GitHub Dependabot SHOULD be enabled for automated dependency updates (SHOULD)
- **Global SDK**: `global.json` MUST specify SDK version with `allowPrerelease` for early adopters (MUST)

**Evidence**:
- All projects target `net10.0`
- `global.json` specifies SDK 10.* with `allowPrerelease: true`
- Dependabot configured: `.github/dependabot.yml`
- Recent package versions: EF Core 10.0.2, Swashbuckle 10.1.1, MSTest 4.0.2

---

### X. Docker & Containerization (MANDATORY)

Containerization demonstrates cloud-native deployment patterns.

- **Multi-Stage Build**: Dockerfile MUST use multi-stage builds to minimize image size (MUST)
- **Alpine Linux**: Base images SHOULD use Alpine for security and size benefits (SHOULD)
- **Security Updates**: Dockerfile MUST run aggressive package updates (`apk upgrade`, `apt dist-upgrade`) (MUST)
- **Non-Root User**: Containers MUST run as non-root user (MUST)
- **Hadolint**: Dockerfile MUST pass hadolint linting (with documented exceptions) (MUST)

**Evidence**:
- Multi-stage Dockerfile: `base → build → publish → final`
- Alpine base: `mcr.microsoft.com/dotnet/nightly/aspnet:10.0-alpine`
- Non-root user: `appuser` created and used
- Hadolint run in CI with ignored rules: `DL3008, DL3018, DL3015`
- Security updates: `apk upgrade --available`, `apt-get dist-upgrade -y`

---

## Additional Patterns (OBSERVED)

These patterns are consistently applied but not formalized as hard requirements:

### Build Configuration
- **Deterministic Builds**: Disabled (`<Deterministic>false</Deterministic>`) for timestamp-based versioning
- **Assembly Versioning**: Auto-generated from build timestamp: `10.YYMM.DDHH.MMSS`
- **Trim Analysis**: Enabled for performance (`<EnableTrimAnalyzer>true</EnableTrimAnalyzer>`)

### Web Configuration
- **Configuration Binding Generator**: Enabled for source generation performance
- **Request Delegate Generator**: Enabled for minimal API performance
- **Optimization Preference**: Set to `Speed` for ASP.NET projects

### Editor Configuration
- **Organize Usings**: `dotnet_sort_system_directives_first = true`
- **CA1707 Suppressed**: Underscores allowed in test method names
- **Nullable Warnings**: Set to `suggestion` rather than `error` for incremental adoption

---

### XI. AI-Assisted Development & Documentation Organization (MANDATORY)

All AI/Copilot-generated artifacts, session work, and drafts must be organized under `/.documentation/copilot/` to maintain clean separation and discoverability.

**Required Structure**:

- **Session Work**: `/.documentation/copilot/session-{YYYY-MM-DD}/`
  - Session-specific work, planning, and context
  - Naming: Use ISO date format (e.g., `session-2026-02-05/`)
  - Contents: specs, plans, tasks, analysis, prompts used
  - Retention: Keep for project history and learning

- **Draft Documents**: `/.documentation/copilot/drafts/`
  - Work-in-progress documents not yet finalized
  - Constitution drafts, specification drafts, plan variations
  - Move to appropriate permanent location when finalized

- **Audit Reports**: `/.documentation/copilot/audit/`
  - Code quality audits, compliance checks, site audits
  - Architecture analysis, technical debt reports
  - Historical audit trail for tracking improvements

- **Prompts & Templates**: `/.documentation/copilot/prompts/`
  - Reusable prompts for common tasks
  - Agent instructions and custom workflows
  - Template refinements and variations

**File Organization Rules**:

- **MUST**: All Copilot-generated session work goes under `/.documentation/copilot/session-{date}/` (MUST)
- **MUST**: Constitution drafts and major document drafts use `/.documentation/copilot/drafts/` (MUST)
- **MUST**: Never commit Copilot artifacts to project root or mixed with source code (MUST)
- **SHOULD**: Use descriptive filenames with domain prefix (e.g., `spec-auth-feature.md`, `audit-2026-02-security.md`) (SHOULD)
- **SHOULD**: Archive completed sessions after finalizing artifacts to permanent locations (SHOULD)

**Permanent Documentation Locations**:

- **Constitution**: `/.documentation/memory/constitution.md` (finalized)
- **Architecture Decisions**: `/.documentation/architecture/` or `/docs/architecture/`
- **Feature Specs**: `/.documentation/features/{feature-name}/` or project-appropriate location
- **Release Notes**: Root `CHANGELOG.md` or `/.documentation/releases/`

**Workflow Example**:

```
1. Start session → Create /.documentation/copilot/session-2026-02-05/
2. Generate draft → Save to /.documentation/copilot/drafts/constitution-draft.md
3. Review & approve → Move to /.documentation/memory/constitution.md
4. Archive session → Keep session-2026-02-05/ for historical reference
```

**Rationale**:
- **Discoverability**: All AI-generated work in one predictable location
- **Clean Repository**: Prevents clutter in source directories
- **Historical Context**: Session folders preserve decision-making trail
- **Educational Value**: Learners can see the evolution of design decisions
- **Collaboration**: Team members know where to find AI-generated artifacts

**Evidence**:
- Existing structure discovered: `/.documentation/copilot/audit/`, `/.documentation/memory/`, `/.documentation/templates/`
- Current practice aligns partially; formalizing for consistency
- This constitution draft initially placed in `/.documentation/memory/constitution-draft.md` (should be in `drafts/`)

**Action Required**: Migrate this file to `/.documentation/copilot/drafts/constitution-draft.md` before finalization

---

## Governance

### Amendment Process
- Constitution amendments require discussion and PR review
- Breaking changes to principles require updating affected code
- Major principle changes should be tagged in git (e.g., `constitution-v2.0`)

### Compliance
- All PRs SHOULD be reviewed against constitution principles
- CI/CD workflows enforce MUST requirements automatically
- SHOULD requirements are encouraged but not blocking

### Educational Mission Priority
- When MUST requirements conflict with educational clarity, document the trade-off
- Demonstrate best practices while keeping code accessible to learners
- Prioritize: **Security > Correctness > Educational Value > Performance > Cosmetics**

### Review Schedule
- Constitution SHOULD be reviewed annually or when .NET major versions release
- Update patterns when new C# language features are adopted
- Archive old patterns in CHANGELOG for historical reference

---

## Gaps Identified (Consider Adding)

Based on ASP.NET Core best practices, these areas have no clear pattern or explicit decision:

| Area | Common Principle | Why Consider |
|------|------------------|--------------|
| **Rate Limiting** | APIs SHOULD have rate limiting | DDoS protection, educational value |
| **CORS Policies** | CORS MUST be explicitly configured | Security, cross-origin API access |
| **Input Validation** | Use FluentValidation or data annotations | Security, data integrity |
| **Request Correlation** | Add correlation IDs for tracing | Observability, debugging |
| **Pagination Standards** | Standardize pagination approach | API consistency (PagingParameterModel exists) |
| **API Versioning** | Use versioned endpoints (`/api/v1/`) | API evolution, breaking changes |
| **Response Compression** | Enable gzip/brotli compression | Performance, bandwidth |
| **Caching Strategy** | Define caching layers (in-memory, Redis) | Performance, scalability |

**Recommendation**: Address these in future constitution updates as the project evolves.

---

## Version History

**Version**: 0.1.0-draft  
**Generated**: 2026-02-05  
**Generated By**: /speckit.discover-constitution agent  
**Questions Answered**: 10 + 1 organizational requirement  
**Principles Formalized**: 11 core + 16 discovered patterns  
**Status**: DRAFT - Pending review and finalization

---

## Next Steps

1. **Review this draft**: Carefully read each principle and verify alignment with project goals
2. **Team discussion**: If working with others, share for feedback
3. **Finalize**: Run `/speckit.constitution` to create the official constitution from this draft
4. **Validate compliance**: Run `/speckit.site-audit` to check codebase against principles
5. **Address gaps**: Create issues for missing implementations (test workflow, exception handler, 25% coverage)
6. **Update documentation**: Ensure SECURITY.md clearly states educational-only scope

---

## Files Referenced in Discovery

**Configuration Files**:
- `.editorconfig` - Code analysis rules
- `global.json` - SDK version
- `nuget.config` - NuGet sources
- All `*.csproj` files - Project settings

**Source Files Analyzed**:
- `Program.cs` - Application startup
- `IEmployeeService.cs` - Repository interface
- `EmployeeDatabaseService.cs` - Repository implementation
- `EnumerableExtensionsTest.cs` - Test pattern example
- `GlobalUsings.cs` files - Implicit usings

**Workflow Files**:
- `.github/workflows/codeql-analysis.yml`
- `.github/workflows/docker-image.yml`
- `.github/dependabot.yml`

**Documentation**:
- `README.md` - Project overview
- `CONTRIBUTING.md` - Contribution guidelines
- `CHANGELOG.md` - Project history
- `SECURITY.md` - Security policy (needs update)

**Total Files Analyzed**: 94 C# source files, 10 project files, 5 workflow/config files, 4 documentation files
